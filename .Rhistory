totrain <- X %>% dplyr::group_by(Year) %>% dplyr::arrange(Date) %>% summarise(TOTRAIN = sum(Value))
totrain <- totrain %>% as.data.frame
totrain
plot(totrain, ty = 'l')
dr_stress <- function(PREC, p_thresh = 1){
runs <- rle(PREC < p_thresh)
cons_days <- max(runs$lengths[runs$values==1], na.rm=TRUE)
return(cons_days)
}
dr_stressCMP <- cmpfun(dr_stress); rm(dr_stress)
cdd <- X %>% dplyr::group_by(Year) %>% dplyr::arrange(Date) %>% summarise(CDD = dr_stressCMP(Value, p_thresh = 1))
cdd <- cdd %>% as.data.frame
library(compiler)
dr_stress <- function(PREC, p_thresh = 1){
runs <- rle(PREC < p_thresh)
cons_days <- max(runs$lengths[runs$values==1], na.rm=TRUE)
return(cons_days)
}
dr_stressCMP <- cmpfun(dr_stress); rm(dr_stress)
cdd <- X %>% dplyr::group_by(Year) %>% dplyr::arrange(Date) %>% summarise(CDD = dr_stressCMP(Value, p_thresh = 1))
cdd <- cdd %>% as.data.frame
plot(cd, ty = 'l')
plot(cdd, ty = 'l')
run_avg <- function(x){
z <- caTools::runmean(x, k = 5, endrule = 'NA')
z <- max(z, na.rm = TRUE)
return(z)
}
p5d <- X %>% dplyr::group_by(Year) %>% dplyr::arrange(Date) %>% summarise(P5D = run_avg(x = Value))
p5d <- p5d %>% as.data.frame
plot(p5d, ty = 'l')
p_95 <- X %>% dplyr::group_by(Year) %>% dplyr::arrange(Date) %>% summarise(P_95 = quantile(Value, probs = .95, na.rm = TRUE))
p_95 <- p_95 %>% as.data.frame
names(p_95)[2] <- "Value"; p_95$Variable <- "P_95"
plot(p_95, ty = "l")
View(p_95)
plot(p_95[,1:2], ty = "l")
table(prec$Duration)
table(prec$Duration)/4590
table(prec$Duration)/4931
View(prec)
View(prec[prec$Duration == "Two years",])
-9.987535e-01
-9.987535e-02
-9.987535e-02
5.752047e+00
-9.987535e-02
-4.069580e-01
-2.896928e+00
suppressMessages(if(!require(raster)){install.packages('raster'); library(raster)} else {library(raster)})
suppressMessages(if(!require(ncdf4)){install.packages('ncdf4'); library(ncdf4)} else {library(ncdf4)})
suppressMessages(if(!require(maptools)){install.packages('maptools'); library(maptools)} else {library(maptools)})
suppressMessages(if(!require(ff)){install.packages('ff'); library(ff)} else {library(ff)})
suppressMessages(if(!require(data.table)){install.packages('data.table'); library(data.table)} else {library(data.table)})
suppressMessages(if(!require(miscTools)){install.packages('miscTools'); library(miscTools)} else {library(miscTools)})
suppressMessages(if(!require(rgdal)){install.packages('rgdal'); library(rgdal)} else {library(rgdal)})
suppressMessages(if(!require(foreach)){install.packages('foreach'); library(foreach)} else {library(foreach)})
suppressMessages(if(!require(mgcv)){install.packages('mgcv'); library(mgcv)} else {library(mgcv)})
suppressMessages(if(!require(rasterVis)){install.packages('rasterVis'); library(rasterVis)} else {library(rasterVis)})
suppressMessages(if(!require(stringr)){install.packages('stringr'); library(stringr)} else {library(stringr)})
suppressMessages(if(!require(tidyverse)){install.packages('tidyverse'); library(tidyverse)} else {library(tidyverse)})
suppressMessages(if(!require(mapdata)){install.packages('mapdata'); library(mapdata)} else {library(mapdata)})
suppressMessages(if(!require(FactoMineR)){install.packages('FactoMineR'); library(FactoMineR)} else {library(FactoMineR)})
suppressMessages(if(!require(FactoClass)){install.packages('FactoClass'); library(FactoClass)} else {library(FactoClass)})
suppressMessages(if(!require(ade4)){install.packages('ade4'); library(ade4)} else {library(ade4)})
suppressMessages(if(!require(xtable)){install.packages('xtable'); library(xtable)} else {library(xtable)})
suppressMessages(if(!require(ggdendro)){install.packages('ggdendro'); library(ggdendro)} else {library(ggdendro)})
suppressMessages(if(!require(compiler)){install.packages('compiler'); library(compiler)} else {library(compiler)})
suppressMessages(if(!require(ggthemes)){install.packages('ggthemes'); library(ggthemes)} else {library(ggthemes)})
suppressMessages(if(!require(dtwclust)){install.packages('dtwclust'); library(dtwclust)} else {library(dtwclust)})
suppressMessages(if(!require(cluster)){install.packages('cluster'); library(cluster)} else {library(cluster)})
OSys <- Sys.info(); OSys <- OSys[names(OSys)=="sysname"]
if(OSys == "Linux"){
root <- "/mnt/workspace_cluster_9"
base <- readRDS(paste0(root, "/CWR_pre-breeding/Input_data/AgMerra_template.RDS"))
} else {
if(OSys == "Windows"){
root <- "//dapadfs/Workspace_cluster_9"
base <- readRDS(paste0(root, "/CWR_pre-breeding/Input_data/AgMerra_template.RDS"))
}
}; rm(OSys)
plot(base)
2010-1981
?save
load("//dapadfs/workspace_cluster_8/Kenya_KACCAL/data/bc_quantile_0_05deg_lat/bcc_csm1_1/2021_2045/rcp60/Machakos/tmax/bc_qmap_tmax_2021_2045.RData")
dim(gcmFutBC)
suppressMessages(library(tidyverse))
final.coordinates <- read.csv("~/KenyaMatrixCrop_rainfed.csv", row.names = 1)
final.coordinates <- read.csv("~/KenyaMatrixCrop_rainfed.csv")
View(final.coordinates)
soil.coordinates <- read.table(file = "//dapadfs/workspace_cluster_3/bid-cc-agricultural-sector/02-Soil-data/data_hc3ksol_5m_global.txt", header = T)
soil.coordinates <- soil.coordinates %>% dplyr::group_by(CELL5M) %>% dplyr::arrange(-SharePct)
soil.raster <- raster::raster("//dapadfs/workspace_cluster_3/bid-cc-agricultural-sector/02-Soil-data/cell5m.asc")
cellID <- raster::cellFromXY(object = soil.raster, xy = final.coordinates)
cellID <- raster::cellFromXY(object = soil.raster, xy = final.coordinates[,c("x", "y")])
soil.coordinates.filtered <- soil.coordinates[na.omit(match(cellID, soil.coordinates$CELL5M)),]; rownames(soil.coordinates.filtered) <- 1:nrow(soil.coordinates.filtered)
names(soil.coordinates.filtered)[1] <- "CELL30M"
rm(cellID, soil.raster)
View(soil.coordinates.filtered)
length(unique(soil.coordinates.filtered$CELL30M))
View(soil.coordinates.filtered)
sourceCpp("fastPdist.cpp") # Pairwise Euclidean distance function in C++
suppressMessages(if(!require(raster)){install.packages('raster'); library(raster)} else {library(raster)})
suppressMessages(if(!require(ncdf4)){install.packages('ncdf4'); library(ncdf4)} else {library(ncdf4)})
suppressMessages(if(!require(maptools)){install.packages('maptools'); library(maptools)} else {library(maptools)})
suppressMessages(if(!require(ff)){install.packages('ff'); library(ff)} else {library(ff)})
suppressMessages(if(!require(data.table)){install.packages('data.table'); library(data.table)} else {library(data.table)})
suppressMessages(if(!require(miscTools)){install.packages('miscTools'); library(miscTools)} else {library(miscTools)})
suppressMessages(if(!require(rgdal)){install.packages('rgdal'); library(rgdal)} else {library(rgdal)})
suppressMessages(if(!require(foreach)){install.packages('foreach'); library(foreach)} else {library(foreach)})
suppressMessages(if(!require(mgcv)){install.packages('mgcv'); library(mgcv)} else {library(mgcv)})
suppressMessages(if(!require(rasterVis)){install.packages('rasterVis'); library(rasterVis)} else {library(rasterVis)})
suppressMessages(if(!require(stringr)){install.packages('stringr'); library(stringr)} else {library(stringr)})
suppressMessages(if(!require(tidyverse)){install.packages('tidyverse'); library(tidyverse)} else {library(tidyverse)})
suppressMessages(if(!require(mapdata)){install.packages('mapdata'); library(mapdata)} else {library(mapdata)})
suppressMessages(if(!require(FactoMineR)){install.packages('FactoMineR'); library(FactoMineR)} else {library(FactoMineR)})
suppressMessages(if(!require(FactoClass)){install.packages('FactoClass'); library(FactoClass)} else {library(FactoClass)})
suppressMessages(if(!require(ade4)){install.packages('ade4'); library(ade4)} else {library(ade4)})
suppressMessages(if(!require(xtable)){install.packages('xtable'); library(xtable)} else {library(xtable)})
suppressMessages(if(!require(ggdendro)){install.packages('ggdendro'); library(ggdendro)} else {library(ggdendro)})
suppressMessages(if(!require(compiler)){install.packages('compiler'); library(compiler)} else {library(compiler)})
suppressMessages(if(!require(ggthemes)){install.packages('ggthemes'); library(ggthemes)} else {library(ggthemes)})
suppressMessages(if(!require(dtwclust)){install.packages('dtwclust'); library(dtwclust)} else {library(dtwclust)})
suppressMessages(if(!require(cluster)){install.packages('cluster'); library(cluster)} else {library(cluster)})
sourceCpp("fastPdist.cpp") # Pairwise Euclidean distance function in C++
library(Rcpp)
library(RcppArmadillo)
sourceCpp("fastPdist.cpp") # Pairwise Euclidean distance function in C++
library("RcppEigen", lib.loc="~/R/win-library/3.4")
library("RcppRoll", lib.loc="~/R/win-library/3.4")
library("bindrcpp", lib.loc="~/R/win-library/3.4")
sourceCpp("fastPdist.cpp") # Pairwise Euclidean distance function in C++
library(feather)
install.packages("feather")
library("feather", lib.loc="~/R/win-library/3.4")
?over
?saveRDS
source('//dapadfs/workspace_cluster_8/Kenya_KACCAL/scripts/KACCAL_calc_risk_indices_modified.R')
options(warn = -1); options(scipen = 999)
suppressMessages(library(raster))
suppressMessages(library(ncdf))
suppressMessages(library(ncdf4))
suppressMessages(library(maptools))
suppressMessages(library(ff))
suppressMessages(library(data.table))
suppressMessages(library(miscTools))
suppressMessages(library(compiler))
countyList <- data.frame(Cluster=c(rep('Cluster 1', 8),
rep('Cluster 2', 8)),
County=c('Bomet', 'Kericho', 'Kakamega', 'Uasin Gishu', 'Keiyo-Marakwet', 'Machakos', 'Kisumu', 'Kajiado',
'Baringo', 'Laikipia', 'Tharaka', 'Lamu', 'Marsabit', 'Isiolo', 'Wajir', 'Mandera'))
countyList$Cluster <- as.character(countyList$Cluster)
countyList$County <- as.character(countyList$County)
countyList <- countyList[1,]
countyList
county='Bomet', season='first'
county='Bomet'; season='first'
cat('\n\n\n*** Processing:', gsub(pattern=' ', replacement='_', county, fixed=TRUE), 'county ***\n\n')
countyDir <- paste(inputDir, '/', gsub(pattern=' ', replacement='_', county, fixed=TRUE), sep='')
inputDir <- '//dapadfs/workspace_cluster_12/Kenya_KACCAL/data/input_tables'
outputDir <- '//dapadfs/workspace_cluster_12/Kenya_KACCAL/results/climatic_indices/historical'
seasonList <- c('first', 'second')
cat('\n\n\n*** Processing:', gsub(pattern=' ', replacement='_', county, fixed=TRUE), 'county ***\n\n')
countyDir <- paste(inputDir, '/', gsub(pattern=' ', replacement='_', county, fixed=TRUE), sep='')
dir.exists(countyDir)
indexes <- paste(outputDir, '/', season, '_season/', gsub(pattern=' ', replacement='_', county, fixed=TRUE), '_', season, '_season_2015.RData', sep='')
indexes
cat('Loading raster mask for:', gsub(pattern=' ', replacement='_', county), '\n')
countyMask <- raster(paste("//dapadfs/workspace_cluster_12/Kenya_KACCAL/data/Kenya_counties_rst/", gsub(pattern=' ', replacement='_', county), "_base.tif", sep=""))
cat('Loading: Solar radiation for first wet season\n')
if(season == 'first'){
load(paste(countyDir, '/dswrf/dswrf_fs_wet_days.RData', sep=''))
dswrf <- first_season_var; rm(first_season_var)
} else {
if(season == 'second'){
load(paste(countyDir, '/dswrf/dswrf_ss_wet_days.RData', sep=''))
dswrf <- second_season_var; rm(second_season_var)
}
}
dswrf <- dswrf[years_analysis]
dswrf <- lapply(1:length(dswrf), function(i){z <- as.data.frame(dswrf[[i]]); yr <- as.numeric(gsub(pattern='y', replacement='', x=names(dswrf)[i])); names(z)[4:length(names(z))] <- as.character(seq(as.Date(paste(yr, '-01-01', sep='')), as.Date(paste(yr, '-12-31', sep='')), by=1)); return(z)})
names(dswrf) <- years_analysis
dswrf <- reshape::merge_recurse(dswrf)
years_analysis <- paste('y', 1981:2005, sep='')
if(season == 'first'){
load(paste(countyDir, '/dswrf/dswrf_fs_wet_days.RData', sep=''))
dswrf <- first_season_var; rm(first_season_var)
} else {
if(season == 'second'){
load(paste(countyDir, '/dswrf/dswrf_ss_wet_days.RData', sep=''))
dswrf <- second_season_var; rm(second_season_var)
}
}
dswrf <- dswrf[years_analysis]
dswrf <- lapply(1:length(dswrf), function(i){z <- as.data.frame(dswrf[[i]]); yr <- as.numeric(gsub(pattern='y', replacement='', x=names(dswrf)[i])); names(z)[4:length(names(z))] <- as.character(seq(as.Date(paste(yr, '-01-01', sep='')), as.Date(paste(yr, '-12-31', sep='')), by=1)); return(z)})
names(dswrf) <- years_analysis
dswrf <- reshape::merge_recurse(dswrf)
if(season == 'first'){
load(paste(countyDir, '/prec/prec_fs_wet_days.RData', sep=''))
prec <- chirps_wet_days; rm(chirps_wet_days)
} else {
if(season == 'second'){
load(paste(countyDir, '/prec/prec_ss_wet_days.RData', sep=''))
prec <- chirps_wet_days; rm(chirps_wet_days)
}
}
years_prec <- gsub(pattern='y', replacement='', names(prec))
# prec <- prec[years_analysis]
prec <- lapply(1:length(prec), function(i){z <- as.data.frame(prec[[i]]); yr <- as.numeric(gsub(pattern='y', replacement='', x=names(prec)[i])); names(z)[4:length(names(z))] <- as.character(seq(as.Date(paste(yr, '-01-01', sep='')), as.Date(paste(yr, '-12-31', sep='')), by=1)); return(z)})
names(prec) <- years_analysis
prec <- reshape::merge_recurse(prec)
load(paste(countyDir, '/soil/soil_data.RData', sep=''))
soil <- soil_data_county; rm(soil_data_county)
soil <- soil[,c("cellID","lon.x","lat.x","id_coarse","rdepth","d.25","d.100","d.225","d.450","d.800","d.1500","soilcp")]
names(soil)[2:3] <- c('lon','lat')
View(soil)
library(ggplot2)
ggplot(data = soil, aes(x = lon, y = lat, fill = soilcp)) +
geom_raster() +
coord_equal() +
theme_bw()
ggplot(data = soil, aes(x = lon, y = lat, fill = soilcp)) +
geom_raster() +
coord_equal() +
theme_bw() + scale_colour_gradientn(colours = terrain.colors(10))
ggplot(data = soil, aes(x = lon, y = lat, fill = soilcp)) +
geom_raster() +
coord_equal() +
theme_bw() + scale_fill_gradientn(colours = terrain.colors(10))
ggplot(data = soil, aes(x = lon, y = lat, fill = soilcp)) +
geom_raster() +
coord_equal() +
theme_bw() + scale_fill_gradientn(colours = viridis)
library(viridisLite)
ggplot(data = soil, aes(x = lon, y = lat, fill = soilcp)) +
geom_raster() +
coord_equal() +
theme_bw() + scale_fill_gradientn(colours = viridis)
ggplot(data = soil, aes(x = lon, y = lat, fill = soilcp)) +
geom_raster() +
coord_equal() +
theme_bw() + scale_fill_gradientn(colours = "viridis")
ggplot(data = soil, aes(x = lon, y = lat, fill = soilcp)) +
geom_raster() +
coord_equal() +
theme_bw() + scale_fill_gradientn(colours = viridis())
ggplot(data = soil, aes(x = lon, y = lat, fill = soilcp)) +
geom_raster() +
coord_equal() +
theme_bw() + scale_fill_gradientn(colours = vir)
ggplot(data = soil, aes(x = lon, y = lat, fill = soilcp)) +
geom_raster() +
coord_equal() +
theme_bw() + scale_fill_gradientn(colours = "vir")
ggplot(data = soil, aes(x = lon, y = lat, fill = soilcp)) +
geom_raster() +
coord_equal() +
theme_bw() + scale_fill_gradientn(colours = inferno(256))
library("GSIF", lib.loc="~/R/win-library/3.4")
demo("GSIF")
install.packages(c("extraDistr", "glmnet"))
install.packages("corpcor")
library(dtwSat)
install.packages(c("extraDistr", "glmnet"))
library(bfastSpatial )
install.packages("bfastSpatial")
library(devtools)
install_github('loicdtx/bfastSpatial')
suppressMessages(if(!require(raster)){install.packages('raster'); library(raster)} else {library(raster)})
suppressMessages(if(!require(ncdf4)){install.packages('ncdf4'); library(ncdf4)} else {library(ncdf4)})
suppressMessages(if(!require(maptools)){install.packages('maptools'); library(maptools)} else {library(maptools)})
suppressMessages(if(!require(ff)){install.packages('ff'); library(ff)} else {library(ff)})
suppressMessages(if(!require(data.table)){install.packages('data.table'); library(data.table)} else {library(data.table)})
suppressMessages(if(!require(miscTools)){install.packages('miscTools'); library(miscTools)} else {library(miscTools)})
suppressMessages(if(!require(rgdal)){install.packages('rgdal'); library(rgdal)} else {library(rgdal)})
suppressMessages(if(!require(foreach)){install.packages('foreach'); library(foreach)} else {library(foreach)})
suppressMessages(if(!require(mgcv)){install.packages('mgcv'); library(mgcv)} else {library(mgcv)})
suppressMessages(if(!require(rasterVis)){install.packages('rasterVis'); library(rasterVis)} else {library(rasterVis)})
suppressMessages(if(!require(stringr)){install.packages('stringr'); library(stringr)} else {library(stringr)})
suppressMessages(if(!require(tidyverse)){install.packages('tidyverse'); library(tidyverse)} else {library(tidyverse)})
suppressMessages(if(!require(mapdata)){install.packages('mapdata'); library(mapdata)} else {library(mapdata)})
suppressMessages(if(!require(FactoMineR)){install.packages('FactoMineR'); library(FactoMineR)} else {library(FactoMineR)})
suppressMessages(if(!require(FactoClass)){install.packages('FactoClass'); library(FactoClass)} else {library(FactoClass)})
suppressMessages(if(!require(ade4)){install.packages('ade4'); library(ade4)} else {library(ade4)})
suppressMessages(if(!require(xtable)){install.packages('xtable'); library(xtable)} else {library(xtable)})
suppressMessages(if(!require(ggdendro)){install.packages('ggdendro'); library(ggdendro)} else {library(ggdendro)})
suppressMessages(if(!require(compiler)){install.packages('compiler'); library(compiler)} else {library(compiler)})
suppressMessages(if(!require(ggthemes)){install.packages('ggthemes'); library(ggthemes)} else {library(ggthemes)})
#suppressMessages(if(!require(dtwclust)){install.packages('dtwclust'); library(dtwclust)} else {library(dtwclust)})
suppressMessages(if(!require(cluster)){install.packages('cluster'); library(cluster)} else {library(cluster)})
OSys <- Sys.info(); OSys <- OSys[names(OSys)=="sysname"]
if(OSys == "Linux"){
root <- "/mnt/workspace_cluster_9"
base <- readRDS(paste0(root, "/CWR_pre-breeding/Input_data/AgMerra_template.RDS"))
} else {
if(OSys == "Windows"){
root <- "//dapadfs/Workspace_cluster_9"
base <- readRDS(paste0(root, "/CWR_pre-breeding/Input_data/AgMerra_template.RDS"))
}
}; rm(OSys)
planting_rf_ggcmi <- raster::brick(paste0(root, "/CWR_pre-breeding/Input_data/GGCMI-data/Pulses_rf_growing_season_dates_v1.25.nc4", sep = ""), varname = "planting day")
planting_rf_ggcmi <- planting_rf_ggcmi[[1]]
# Harversting dates
harvest_rf_ggcmi <- raster::brick(paste0(root, "/CWR_pre-breeding/Input_data/GGCMI-data/Pulses_rf_growing_season_dates_v1.25.nc4", sep = ""), varname = "harvest day")
harvest_rf_ggcmi <- harvest_rf_ggcmi[[1]]
library(raster)
r <- raster::stack("//ccafsserver.cgiarad.org/data_climatewizard/AR5_Global_Daily_25k/pr_day_BCSD_historical_r1i1p1_ACCESS1-0_1962.nc")
r
plot(r[[1]])
r <- raster::stack("//ccafsserver.cgiarad.org/data_climatewizard/AR5_Global_Daily_25k/pr_day_BCSD_rcp45_r1i1p1_CCSM4_2063.nc")
r
plot(r[[1]])
rm(r)
?quantile
r <- raster(ncol=100, nrow=100)
r[] <- rnorm(ncell(r), 0, 50)
quantile(r)
plot(er)
plot(r)
quantile(r, probs = c(0.25, 0.75), type=7,names = FALSE)
?raster::calc
r <- raster(ncols=36, nrows=18)
r[] <- 1:ncell(r)
plot(r)
r2 <- raster(ncols=36, nrows=18)
r2[] <- 1:ncell(r2)
r2[50:69] <- NA
plot(r2)
rStack <- stack(r, r2)
raster::calc(rStack, fun = function(x, y){y-x})
raster::calc(rStack, fun = function(x, y){return(y-x)})
?raster::overlay()
?raster::overlay
r3 <- overlay(r, r2, fun=function(x,y){return(y-x)})
plot(r3)
r3 <- overlay(r, r2, fun=function(x,y){return(na.omit(y)-na.omit(x))})
r3 <- overlay(r, r2, fun=function(x,y){x[which(is.na(x))] <- 0; y[which(is.na(y))] <- 0; z <- y-x; return(z)})
plot(r3)
?scale_fill_distiller
library(ggplot2)
?scale_fill_distiller
?mask
source('~/.active-rstudio-document', echo=TRUE)
library(raster)
library(rgadal)
library(rgdal)
tmin <- raster::stack("//dapadfs/Workspace_cluster_9/CWR_pre-breeding/Results/input_tables/agmerra_tmin/tmin_filtered_europa.rds")
tmin <- readRDS("//dapadfs/Workspace_cluster_9/CWR_pre-breeding/Results/input_tables/agmerra_tmin/tmin_filtered_europa.rds")
plot(tmin$lon, tmin$lat)
tmax <- readRDS("//dapadfs/Workspace_cluster_9/CWR_pre-breeding/Results/input_tables/agmerra_tmax/tmax_filtered_europa.rds")
plot(tmax$lon, tmax$lat)
plot(tmin$lon, tmin$lat)
plot(tmax$lon, tmax$lat)
prec <- readRDS("//dapadfs/Workspace_cluster_9/CWR_pre-breeding/Results/input_tables/chirps/prec_filtered_europa.rds")
plot(prec$lon, prec$lat)
prec <- readRDS("//dapadfs/Workspace_cluster_9/CWR_pre-breeding/Results/input_tables/chirps/prec_filtered_europa.rds")
plot(tmax$lon, tmax$lat)
plot(prec$lon, prec$lat)
# R options
options(warn = -1); options(scipen = 999); g <- gc(reset = T); rm(list = ls())
gi <- readRDS("//dapadfs/Workspace_cluster_9/CWR_pre-breeding/Results/general_indexes/index_tabla_rbind_europa_completo.rds")
names(gi)
head(gi)
unique(gi$Variable)
hist(gi$Value[gi$Variable == "TOTRAIN"])
hist(as.numeric(gi$Value[gi$Variable == "TOTRAIN"]))
hist(as.numeric(gi$Value[gi$Variable == "CDD"]))
hist(as.numeric(gi$Value[gi$Variable == "P5D"]))
hist(as.numeric(gi$Value[gi$Variable == "P_95"]))
library(dtw)
idx<-seq(0,6.28,len=100);
query<-sin(idx)+runif(100)/10;
idx
query
plot(query)
plot(query, ty = "l")
template<-cos(idx)
plot(template, ty = "l")
library(dtw);
alignment<-dtw(query,template,keep=TRUE);
alignment
plot(alignment,type="threeway")
plot(
dtw(query,template,keep=TRUE,
step=rabinerJuangStepPattern(6,"c")),
type="twoway",offset=-2);
rabinerJuangStepPattern(6,"c")
plot(rabinerJuangStepPattern(6,"c"))
alignment$costMatrix
plot(alignment$costMatrix)
install.packages("parallelDist")
tmp.mat <- matrix(c(1:40), ncol = 10)
tmp.mat
sample.matrix.list <- list(tmp.mat[1:2,], tmp.mat[3:4,])
sample.matrix.list
parDist(x = sample.matrix.list, method = "dtw")
library(parallelDist)
parDist(x = sample.matrix.list, method = "dtw")
sample.matrix.list2 <- sample.matrix.list
sample.matrix.list2[[1]] <- cbind(sample.matrix.list2[[1]][1,], sample.matrix.list2[[1]][2,])
sample.matrix.list2
sample.matrix.list2 <- sample.matrix.list
as.matrix(sample.matrix.list2[[1]][1,])
as.matrix(t(sample.matrix.list2[[1]][1,]))
sample.matrix.list2[[1]] <- cbind(as.matrix(t(sample.matrix.list2[[1]][1,])), as.matrix(t(sample.matrix.list2[[1]][2,])))
sample.matrix.list2
sample.matrix.list2[[2]] <- cbind(as.matrix(t(sample.matrix.list2[[2]][1,])), as.matrix(t(sample.matrix.list2[[2]][2,])))
sample.matrix.list2
parDist(x = sample.matrix.list2, method = "dtw")
sample.matrix.list
parDist(x = sample.matrix.list, method = "dtw")
sample.matrix.list2
parDist(x = sample.matrix.list2, method = "dtw")
df <- readRDS("//dapadfs/Workspace_cluster_9/CWR_pre-breeding/Results/Bean/General_indexes/dist_global_index_ciat_palmira.rds")
head(df)
df <- readRDS("//dapadfs/Workspace_cluster_9/CWR_pre-breeding/Results/Bean/General_indexes/global_index_estandarizados_frijol.rds")
head(df)
df <- readRDS("//dapadfs/Workspace_cluster_9/CWR_pre-breeding/Results/Bean/General_indexes/tabla_rbind_frijol_europa.rds")
head(df)
unique(df$Variable)
library(tidyverse)
df <- df %>% filter(Variable != "Error in xj[i] : only 0's may be mixed with negative subscripts\n")
unique(df$Variable)
df2 <- df %>% filter(cellID == 287280)
names(df2)
df2 %>% spread(key = Year, value = Value, -cellID)
df2 %>% spread(key = Year, value = Value)
df2 <- df2 %>% spread(key = Year, value = Value)
df2
unique(df$cellID)
df3 <- df %>% filter(cellID == 282932)
df3 <- df3 %>% spread(key = Year, value = Value)
df3
sample.matrix.list3 <- list(df2[,3:ncol(df2)], df3[,3:ncol(df3)])
sample.matrix.list3
parDist(x = sample.matrix.list3, method = "dtw")
sample.matrix.list3 <- list(as.matrix(df2[,3:ncol(df2)]), as.matrix(df3[,3:ncol(df3)]))
parDist(x = sample.matrix.list3, method = "dtw")
sample.matrix.list3
colnames(df2) <- paste0("Y", colnames(df2))
colnames(df3) <- paste0("Y", colnames(df3))
colnames(df2)
df2 <- df %>% filter(cellID == 287280)
df2 <- df2 %>% spread(key = Year, value = Value)
df3 <- df %>% filter(cellID == 282932)
df3 <- df3 %>% spread(key = Year, value = Value)
colnames(df2)[3:ncol(df2)] <- paste0("Y", colnames(df2)[3:ncol(df2)])
colnames(df3)[3:ncol(df3)] <- paste0("Y", colnames(df3)[3:ncol(df3)])
colnames(df2)
base::as.matrix(df2[,3:ncol(df2)])
base::as.matrix.data.frame(df2[,3:ncol(df2)])
base::as.matrix.data.frame(df2[,3:ncol(df2)])
base::as.matrix.data.frame(as.numeric(df2[,3:ncol(df2)]))
as.numeric(df2[,3:ncol(df2)])
base::as.matrix(as.numeric(df2[,3:ncol(df2)]))
df2[,3:ncol(df2)]
data.matrix(df2[,3:ncol(df2)])
sample.matrix.list3 <- list(data.matrix(df2[,3:ncol(df2)]), data.matrix(df3[,3:ncol(df3)]))
parDist(x = sample.matrix.list3, method = "dtw")
install.packages(c("BH", "RcppParallel", "tmaptools"))
library(parallelDist)
getAnywhere("parDist")
?parDist
library(tidyverse)
df <- readRDS("//dapadfs/Workspace_cluster_9/CWR_pre-breeding/Results/Bean/General_indexes/tabla_rbind_frijol_europa.rds")
df <- df %>% filter(Variable != "Error in xj[i] : only 0's may be mixed with negative subscripts\n")
df2 <- df %>% filter(cellID == 287280)
df2 <- df2 %>% spread(key = Year, value = Value)
View(df2)
df3 <- df %>% filter(cellID == 282932)
df3 <- df3 %>% spread(key = Year, value = Value)
View(df2)
plot(as.numeric(df2[1, 3:ncol(df2)]))
plot(as.numeric(df2[1, 3:ncol(df2)]), ty = "l")
plot(as.numeric(df3[1, 3:ncol(df3)]), ty = "l", add = T)
plot(as.numeric(df2[1, 3:ncol(df2)]), ty = "l")
plot(as.numeric(df2[1, 3:ncol(df2)]), ty = "l")
lines(as.numeric(df3[1, 3:ncol(df3)]), col = 2)
colnames(df2)[3:ncol(df2)] <- paste0("Y", colnames(df2)[3:ncol(df2)])
colnames(df3)[3:ncol(df3)] <- paste0("Y", colnames(df3)[3:ncol(df3)])
sample.matrix.list3 <- list(data.matrix(df2[,3:ncol(df2)]), data.matrix(df3[,3:ncol(df3)]))
parDist(x = sample.matrix.list3, method = "dtw")
1:nrow(df2)
matrix(data = df2[1, 3:ncol(df2)], nrow = 1, byrow = T)
as.numeric(df2[i, 3:ncol(df2)])
matrix(data = as.numeric(df2[1, 3:ncol(df2)]), nrow = 1, byrow = T)
for(i in 1:nrow(df2)){
l <- list(matrix(data = as.numeric(df2[i, 3:ncol(df2)]), nrow = 1, byrow = T),
matrix(data = as.numeric(df3[i, 3:ncol(df3)]), nrow = 1, byrow = T))
print(parDist(x = l, method = "dtw"))
}
sum(c(0.08918634, 0.008196721, 11, 1, 501, 1))
parDist(x = sample.matrix.list3, method = "dtw")
gi <- readRDS("//dapadfs/Workspace_cluster_9/CWR_pre-breeding/Results/Bean/General_indexes/dist_global_index_ciat_palmira.rds")
head(gi)
gi <- readRDS("//dapadfs/Workspace_cluster_9/CWR_pre-breeding/Results/Bean/General_indexes/global_index_estandarizados_frijol.rds")
head(gi)
gi <- readRDS("//dapadfs/Workspace_cluster_9/CWR_pre-breeding/Results/Bean/General_indexes/tabla_rbind_frijol_europa.rds")
head(gi)
gi$Variable %>% unique()
gi <- readRDS("//dapadfs/Workspace_cluster_9/CWR_pre-breeding/Results/Bean/Crop_indexes/global_index_estandarizados_frijol_calor.rds")
head(gi)
gi <- readRDS("//dapadfs/Workspace_cluster_9/CWR_pre-breeding/Results/Bean/Crop_indexes/dist_global_index_calor_ciat_palmira.rds")
head(gi)
crop = "Bean"
crop %in% c("Bean")
suppressMessages(if(!require(raster)){install.packages('raster'); library(raster)} else {library(raster)})
suppressMessages(if(!require(ncdf4)){install.packages('ncdf4'); library(ncdf4)} else {library(ncdf4)})
suppressMessages(if(!require(maptools)){install.packages('maptools'); library(maptools)} else {library(maptools)})
suppressMessages(if(!require(rgdal)){install.packages('rgdal'); library(rgdal)} else {library(rgdal)})
suppressMessages(if(!require(tidyverse)){install.packages('tidyverse'); library(tidyverse)} else {library(tidyverse)})
?extract
